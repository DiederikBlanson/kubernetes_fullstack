# Adding Multiple Nodes to a Kubernetes Cluster
### Prerequisites
- The new node should have `microk8s` installed.

<br/>

### Step 1: Generate a Token for the New Node
In order to connect the new node to the control plane (master), a token must be generated by the control plane. Run the following command on the control plane:

```bash
microk8s add-node
```

Note: this token is valid for a short amount of time.

<br/>

### Step 2: Choose the Type of Node
On the new node, run the command provided in the output of the previous step to join the cluster as a worker or master node.

<br/>

### Step 3: Add New Node to /etc/hosts
Finally, you must add the new node's IP address and hostname to the /etc/hosts file on all nodes in the cluster. To do this, run the following command on each node, replacing node-ip and node-name with the appropriate values:
```bash
sudo echo "[node-ip] [node-name"] << /etc/hosts
```

<br/>

## Other Commands
- To view the pods on a specific node, run the following command, replacing <node> with the node's hostname: 
```bash
kubectl get pods --all-namespaces -o wide --field-selector spec.nodeName=<node_name>
```

<br/>

## Deschedule Node
In order to make a node unschedulable, execute the following command:
```bash
microk8s cordon <node_name>
```
If you want to make it unschedulable and remove all resources attached to the node, execute the following command. It does not remove the node from the cluster, but makes it unschedulable.
```bash
microk8s drain <node_name> --ignore-daemonsets
```
To make it schedulable again:
```bash
microk8s uncordon <node_name>
```

----
sources: 
- https://ubuntu.com/tutorials/getting-started-with-kubernetes-ha#4-create-a-microk8s-multinode-cluster
- https://github.com/canonical/microk8s/issues/2488